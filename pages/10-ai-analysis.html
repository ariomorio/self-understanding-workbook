<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AIè‡ªå·±åˆ†æ | è‡ªå·±ç†è§£ã®æ•™ç§‘æ›¸</title>
  <link rel="stylesheet" href="../css/style.css">
  <style>
    .ai-header {
      background: linear-gradient(135deg, #673ab7, #9c27b0);
      padding: var(--spacing-lg);
      border-radius: var(--radius-lg);
      text-align: center;
      color: var(--white);
      margin-bottom: var(--spacing-lg);
    }
    .ai-header .emoji { font-size: 3rem; margin-bottom: var(--spacing-sm); }
    .data-summary {
      background: var(--white);
      border-radius: var(--radius-md);
      padding: var(--spacing-md);
      margin-bottom: var(--spacing-md);
      box-shadow: var(--shadow-sm);
    }
    .data-summary h3 {
      color: var(--primary-brown);
      margin-bottom: var(--spacing-sm);
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }
    .data-item {
      display: flex;
      justify-content: space-between;
      padding: var(--spacing-xs) 0;
      border-bottom: 1px solid #eee;
    }
    .data-item:last-child { border-bottom: none; }
    .data-item .label { color: var(--text-light); }
    .data-item .value { font-weight: bold; }
    .data-item .value.complete { color: var(--primary-green); }
    .data-item .value.incomplete { color: var(--gray); }
    .analysis-btn {
      display: block;
      width: 100%;
      background: linear-gradient(135deg, #673ab7, #9c27b0);
      color: var(--white);
      padding: var(--spacing-md);
      border: none;
      border-radius: var(--radius-md);
      font-size: 1.1rem;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      margin-bottom: var(--spacing-lg);
    }
    .analysis-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }
    .analysis-btn:disabled {
      background: var(--gray);
      cursor: not-allowed;
    }
    .analysis-result {
      background: var(--white);
      border-radius: var(--radius-md);
      padding: var(--spacing-md);
      box-shadow: var(--shadow-sm);
      display: none;
    }
    .analysis-result.show { display: block; }
    .analysis-result h3 {
      color: #673ab7;
      margin-bottom: var(--spacing-md);
      text-align: center;
    }
    .analysis-section {
      background: var(--gray-light);
      padding: var(--spacing-md);
      border-radius: var(--radius-sm);
      margin-bottom: var(--spacing-md);
    }
    .analysis-section h4 {
      color: var(--primary-brown);
      margin-bottom: var(--spacing-sm);
    }
    .export-btn {
      display: inline-flex;
      align-items: center;
      gap: var(--spacing-xs);
      background: var(--primary-green);
      color: var(--white);
      padding: var(--spacing-sm) var(--spacing-md);
      border: none;
      border-radius: var(--radius-sm);
      font-weight: bold;
      cursor: pointer;
      margin-right: var(--spacing-sm);
      margin-bottom: var(--spacing-sm);
    }
    .export-btn:hover { opacity: 0.9; }
    .copy-prompt-box {
      background: #f5f5f5;
      padding: var(--spacing-md);
      border-radius: var(--radius-sm);
      margin-top: var(--spacing-md);
      position: relative;
    }
    .copy-prompt-box pre {
      white-space: pre-wrap;
      word-wrap: break-word;
      font-size: 0.85rem;
      max-height: 300px;
      overflow-y: auto;
    }
    .copy-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      background: var(--primary-orange);
      color: var(--white);
      border: none;
      padding: 6px 12px;
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-size: 0.85rem;
    }
  </style>
</head>
<body>
  <header class="page-header" style="background: linear-gradient(135deg, #673ab7, #9c27b0);">
    <h1><span class="icon">ğŸ¤–</span> AIè‡ªå·±åˆ†æ</h1>
  </header>

  <div class="container">
    <div class="ai-header">
      <div class="emoji">ğŸ¤–</div>
      <h2>å…¥åŠ›ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’AIãŒç·åˆåˆ†æ</h2>
      <p>ã“ã‚Œã¾ã§ã®ãƒ¯ãƒ¼ã‚¯ã®å›ç­”ã‚’ã‚‚ã¨ã«<br>ã‚ãªãŸã®è‡ªå·±ç†è§£ã‚’æ·±ã‚ã‚‹ã‚µãƒãƒ¼ãƒˆã‚’ã—ã¾ã™</p>
    </div>

    <!-- ãƒ‡ãƒ¼ã‚¿çŠ¶æ³ -->
    <div class="data-summary">
      <h3>ğŸ“Š å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®çŠ¶æ³</h3>
      <div class="data-item">
        <span class="label">æ€§æ ¼è¨ºæ–­</span>
        <span class="value" id="status-personality">æœªå…¥åŠ›</span>
      </div>
      <div class="data-item">
        <span class="label">ä¾¡å€¤è¦³ãƒ¯ãƒ¼ã‚¯</span>
        <span class="value" id="status-values">æœªå…¥åŠ›</span>
      </div>
      <div class="data-item">
        <span class="label">æ‰èƒ½ãƒ¯ãƒ¼ã‚¯</span>
        <span class="value" id="status-talent">æœªå…¥åŠ›</span>
      </div>
      <div class="data-item">
        <span class="label">æƒ…ç†±ãƒ¯ãƒ¼ã‚¯</span>
        <span class="value" id="status-passion">æœªå…¥åŠ›</span>
      </div>
      <div class="data-item">
        <span class="label">ä½¿å‘½ãƒ»åˆ¤æ–­è»¸ãƒ¯ãƒ¼ã‚¯</span>
        <span class="value" id="status-mission">æœªå…¥åŠ›</span>
      </div>
      <div class="data-item">
        <span class="label">äººç”Ÿã®èª¬æ˜æ›¸</span>
        <span class="value" id="status-life-manual">æœªå…¥åŠ›</span>
      </div>
    </div>

    <!-- AIåˆ†æç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ -->
    <div class="data-summary">
      <h3>ğŸ¯ AIã«åˆ†æã—ã¦ã‚‚ã‚‰ã†</h3>
      <p style="margin-bottom: var(--spacing-md);">ä»¥ä¸‹ã®ãƒœã‚¿ãƒ³ã§ã€å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚’ãŠã•ã‚‹AIã‚„ä»–ã®AIã«è²¼ã‚Šä»˜ã‘ã‚‰ã‚Œã‚‹å½¢å¼ã§å‡ºåŠ›ã—ã¾ã™ã€‚</p>

      <button class="export-btn" onclick="generatePrompt()">
        ğŸ“‹ åˆ†æç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç”Ÿæˆ
      </button>

      <button class="export-btn" onclick="exportJSON()" style="background: #2196f3;">
        ğŸ’¾ JSONã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
      </button>

      <button class="export-btn" onclick="clearAllData()" style="background: #f44336;">
        ğŸ—‘ï¸ ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ
      </button>

      <div class="copy-prompt-box" id="promptBox" style="display: none;">
        <button class="copy-btn" onclick="copyPrompt()">ã‚³ãƒ”ãƒ¼</button>
        <pre id="promptText"></pre>
      </div>
    </div>

    <!-- Lark Baseé€£æº -->
    <div class="data-summary">
      <h3>ğŸ”— Lark Baseé€£æºï¼ˆæº–å‚™ä¸­ï¼‰</h3>
      <p>ä»Šå¾Œã€å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚’Lark Baseã«è‡ªå‹•ä¿å­˜ãƒ»åŒæœŸã™ã‚‹æ©Ÿèƒ½ã‚’è¿½åŠ äºˆå®šã§ã™ã€‚</p>
      <ul style="padding-left: var(--spacing-md); margin-top: var(--spacing-sm); color: var(--text-light);">
        <li>ãƒ¯ãƒ¼ã‚¯ã®å›ç­”ã‚’ã‚¯ãƒ©ã‚¦ãƒ‰ã«è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</li>
        <li>è¤‡æ•°ãƒ‡ãƒã‚¤ã‚¹ã§ã®åŒæœŸ</li>
        <li>AIã«ã‚ˆã‚‹ç¶™ç¶šçš„ãªåˆ†æã¨ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯</li>
      </ul>
    </div>

    <!-- åˆ†æçµæœ -->
    <div class="analysis-result" id="analysisResult">
      <h3>ğŸ“ˆ åˆ†æçµæœ</h3>
      <div class="analysis-section" id="resultContent">
        <!-- åˆ†æçµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
      </div>
    </div>
  </div>

  <nav class="nav-bottom">
    <a href="09-life-manual.html" class="btn btn-secondary">â† å‰ã¸</a>
    <a href="../index.html" class="btn btn-primary">ç›®æ¬¡ã¸æˆ»ã‚‹</a>
  </nav>
  <div class="toast" id="toast"></div>

  <!-- Lark APIé€£æº -->
  <script src="../js/lark-api.js"></script>
  <script src="../js/lark-config.js"></script>
  <script src="../js/data-sync.js"></script>

  <script>
    // ãƒ‡ãƒ¼ã‚¿çŠ¶æ³ã‚’ãƒã‚§ãƒƒã‚¯
    function checkDataStatus() {
      const pages = ['personality', 'values', 'talent', 'passion', 'mission', 'life-manual'];

      pages.forEach(page => {
        const data = localStorage.getItem(`selfUnderstanding_${page}`);
        const statusEl = document.getElementById(`status-${page}`);
        if (data) {
          statusEl.textContent = 'âœ… å…¥åŠ›æ¸ˆã¿';
          statusEl.classList.add('complete');
        } else {
          statusEl.textContent = 'âŒ æœªå…¥åŠ›';
          statusEl.classList.add('incomplete');
        }
      });
    }

    // ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    function getAllData() {
      const data = {};
      const keys = ['personality', 'values', 'talent', 'passion', 'mission', 'life-manual'];

      keys.forEach(key => {
        const stored = localStorage.getItem(`selfUnderstanding_${key}`);
        if (stored) {
          data[key] = JSON.parse(stored);
        }
      });

      data.userName = localStorage.getItem('selfUnderstanding_userName') || 'åŒ¿å';
      return data;
    }

    // åˆ†æç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç”Ÿæˆ
    function generatePrompt() {
      const data = getAllData();

      let prompt = `# è‡ªå·±ç†è§£ãƒ¯ãƒ¼ã‚¯ åˆ†æä¾é ¼\n\n`;
      prompt += `ãƒ¦ãƒ¼ã‚¶ãƒ¼å: ${data.userName}\n\n`;

      // æ€§æ ¼è¨ºæ–­
      if (data.personality) {
        prompt += `## æ€§æ ¼è¨ºæ–­çµæœ\n`;
        prompt += `- ã‚¿ã‚¤ãƒ—: ${data.personality.resultType || 'æœªè¨ºæ–­'}\n`;
        prompt += `- ã†ã•ãï¼ˆçŸ­æœŸé›†ä¸­å‹ï¼‰: ${data.personality.scores?.usagi || 0}ç‚¹\n`;
        prompt += `- ã‹ã‚ï¼ˆé•·æœŸåˆ†æ•£å‹ï¼‰: ${data.personality.scores?.kame || 0}ç‚¹\n`;
        prompt += `- ã‚­ãƒªã‚®ãƒªã‚¹ï¼ˆå¿«æ¥½è¿½æ±‚å‹ï¼‰: ${data.personality.scores?.kirigirisu || 0}ç‚¹\n`;
        prompt += `- ã‚¢ãƒªï¼ˆãƒªã‚¹ã‚¯å›é¿å‹ï¼‰: ${data.personality.scores?.ari || 0}ç‚¹\n\n`;
      }

      // ä¾¡å€¤è¦³
      if (data.values) {
        prompt += `## ä¾¡å€¤è¦³ãƒ¯ãƒ¼ã‚¯\n`;
        prompt += `### æº€ãŸã•ã‚ŒãŸä½“é¨“\n${data.values.q1 || 'æœªå…¥åŠ›'}\n\n`;
        prompt += `### ã‚¤ãƒ©ã£ã¨ã—ãŸä½“é¨“\n${data.values.q2 || 'æœªå…¥åŠ›'}\n\n`;
        prompt += `### é¸ã‚“ã ä¾¡å€¤è¦³\n${data.values.q8?.selected?.join(', ') || 'æœªé¸æŠ'}\n\n`;
        prompt += `### ä¾¡å€¤è¦³ã®èª¬æ˜æ›¸\n${data.values.summary || 'æœªå…¥åŠ›'}\n\n`;
      }

      // æ‰èƒ½
      if (data.talent) {
        prompt += `## æ‰èƒ½ãƒ¯ãƒ¼ã‚¯\n`;
        prompt += `### æ„Ÿè¬ã•ã‚ŒãŸä½“é¨“\n${data.talent.q1 || 'æœªå…¥åŠ›'}\n\n`;
        prompt += `### é¸ã‚“ã æ‰èƒ½\n${data.talent.q7?.join(', ') || 'æœªé¸æŠ'}\n\n`;
        prompt += `### æ‰èƒ½ã®å„ªå…ˆé †ä½\n${data.talent.q8 || 'æœªå…¥åŠ›'}\n\n`;
        prompt += `### æ‰èƒ½ã®èª¬æ˜æ›¸\n${data.talent.q9 || 'æœªå…¥åŠ›'}\n\n`;
      }

      // æƒ…ç†±
      if (data.passion) {
        prompt += `## æƒ…ç†±ãƒ¯ãƒ¼ã‚¯\n`;
        prompt += `### ã¤ã„è¦‹ã¦ã—ã¾ã†ã‚³ãƒ³ãƒ†ãƒ³ãƒ„\n${data.passion.q1 || 'æœªå…¥åŠ›'}\n\n`;
        prompt += `### æ™‚é–“ã‚’å¿˜ã‚Œã‚‹è©±é¡Œ\n${data.passion.q2 || 'æœªå…¥åŠ›'}\n\n`;
        prompt += `### æƒ…ç†±ãƒã‚§ãƒƒã‚¯çµæœ: ${data.passion.q7?.filter(a => a === 'yes').length || 0}/10 YES\n\n`;
        prompt += `### æƒ…ç†±ã‚’ä¸€è¨€ã§\n${data.passion.q11 || 'æœªå…¥åŠ›'}\n\n`;
      }

      // ä½¿å‘½
      if (data.mission) {
        prompt += `## ä½¿å‘½ãƒ»åˆ¤æ–­è»¸ãƒ¯ãƒ¼ã‚¯\n`;
        prompt += `### è‡ªåˆ†ã‚‰ã—ã•ãƒ¯ãƒ¼ãƒ‰\n${data.mission.coreWords || 'æœªå…¥åŠ›'}\n\n`;
        prompt += `### äººç”Ÿã®ç›®çš„\n${data.mission.lifePurpose || 'æœªå…¥åŠ›'}\n\n`;
        prompt += `### äººç”Ÿã®ä½¿å‘½\n${data.mission.lifeMission || 'æœªå…¥åŠ›'}\n\n`;
        prompt += `### äººç”Ÿã®åˆ¤æ–­è»¸\n${data.mission.lifeCompass || 'æœªå…¥åŠ›'}\n\n`;
      }

      // äººç”Ÿã®èª¬æ˜æ›¸
      if (data['life-manual']) {
        prompt += `## äººç”Ÿã®èª¬æ˜æ›¸\n`;
        prompt += `${data['life-manual'].finalManual || 'æœªå…¥åŠ›'}\n\n`;
      }

      prompt += `---\n\n`;
      prompt += `ä¸Šè¨˜ã®è‡ªå·±ç†è§£ãƒ¯ãƒ¼ã‚¯ã®çµæœã‚’åˆ†æã—ã¦ã€ä»¥ä¸‹ã«ã¤ã„ã¦ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’ãã ã•ã„ï¼š\n`;
      prompt += `1. ã“ã®äººã®å¼·ã¿ã¨ç‰¹å¾´ã®ã¾ã¨ã‚\n`;
      prompt += `2. SNSç™ºä¿¡ã§æ´»ã‹ã›ã‚‹ãƒ†ãƒ¼ãƒã‚„åˆ‡ã‚Šå£\n`;
      prompt += `3. å•†å“ãƒ»ã‚µãƒ¼ãƒ“ã‚¹åŒ–ã™ã‚‹ãªã‚‰ã©ã‚“ãªå½¢ãŒåˆã„ãã†ã‹\n`;
      prompt += `4. ä»Šå¾Œã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³ã®ææ¡ˆ\n`;

      document.getElementById('promptText').textContent = prompt;
      document.getElementById('promptBox').style.display = 'block';
      showToast('ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç”Ÿæˆã—ã¾ã—ãŸ', 'success');
    }

    // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒ¼
    function copyPrompt() {
      const text = document.getElementById('promptText').textContent;
      navigator.clipboard.writeText(text).then(() => {
        showToast('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼', 'success');
      });
    }

    // JSONã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
    function exportJSON() {
      const data = getAllData();
      const json = JSON.stringify(data, null, 2);
      const blob = new Blob([json], { type: 'application/json' });
      const url = URL.createObjectURL(blob);

      const a = document.createElement('a');
      a.href = url;
      a.download = `self-understanding-${new Date().toISOString().split('T')[0]}.json`;
      a.click();

      URL.revokeObjectURL(url);
      showToast('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ', 'success');
    }

    // ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ
    function clearAllData() {
      if (confirm('ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
        const keys = ['personality', 'values', 'talent', 'passion', 'mission', 'life-manual', 'userName'];
        keys.forEach(key => {
          localStorage.removeItem(`selfUnderstanding_${key}`);
        });
        checkDataStatus();
        showToast('ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ', 'success');
      }
    }

    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = 'toast ' + type + ' show';
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    document.addEventListener('DOMContentLoaded', checkDataStatus);
  </script>
</body>
</html>
